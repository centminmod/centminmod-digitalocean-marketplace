{
  "variables": {
    "do_token": "{{env `TOKEN`}}",
    "do_image_name": "centos7-packer-snapshot-php72-{{timestamp}}",
    "do_image": "centos-7-x64",
    "do_region": "sfo2",
    "do_size": "c-2",
    "do_tags": "cmm",
    "install_elrepo": "n",
    "install_bbr": "n",
    "install_docker": "n",
    "install_redis": "n",
    "install_auditd": "n",
    "enable_brotli": "n",
    "enable_phppgo": "n",
    "enable_logrotate_zstd": "n",
    "enable_phpfpm_systemd": "n"
  },
  "builders": [
    {
      "type": "digitalocean",
      "api_token": "{{user `do_token`}}",
      "image": "{{user `do_image`}}",
      "region": "{{user `do_region`}}",
      "size": "{{user `do_size`}}",
      "ssh_username": "root",
      "snapshot_name": "{{user `do_image_name`}}",
      "tags": "{{user `do_tags`}}"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "mkdir -p /opt/centminmod"
      ]
    },
    {
      "type": "file",
      "source": "scripts/first-login.sh",
      "destination": "/opt/centminmod/"
    },
    {
      "type": "shell",
      "inline": [
        "chmod +x /opt/centminmod/first-login.sh"
      ]
    },
    {
      "type": "shell",
      "environment_vars": [
        "INSTALL_ELREPO={{user `install_elrepo`}}",
        "INSTALL_BBR={{user `install_bbr`}}",
        "INSTALL_DOCKER={{user `install_docker`}}",
        "INSTALL_REDIS={{user `install_redis`}}",
        "INSTALL_AUDITD={{user `install_auditd`}}",
        "INSTALL_BROTLI={{user `enable_brotli`}}",
        "INSTALL_PHPPGO={{user `enable_phppgo`}}",
        "INSTALL_LOGROTATEZSTD={{user `enable_logrotate_zstd`}}",
        "INSTALL_PHPFPMSYSTEMD={{user `enable_phpfpm_systemd`}}"
      ],
      "scripts": [
        "scripts/cmm-install.sh"
      ],
      "remote_folder": "/home",
      "remote_file": "script_1.sh"
    }
  ]
}